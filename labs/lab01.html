<div class="w3-row w3-padding-32">
  <div class="w3-twothird w3-container w3-margin-top">
    <h1 class="w3-text-teal">Lab 1: Intro to R and RStudio (<a href="lab_code/lab-intro_to_r.Rmd" class="w3-text-grey">.Rmd</a>)</h1>

    <h3 class="w3-text-grey">The RStudio Interface</h3>
    
    <p>
      The goal of this lab is to introduce you to R and RStudio, which you'll be using throughout the course both to learn the statistical concepts discussed in the course and to analyze real data and come to informed conclusions. To clarify which is which: R is the name of the programming language itself and RStudio is a convenient interface.
    </p>
    <p>
      As the labs progress, you are encouraged to explore beyond what the labs dictate; a willingness to experiment will make you a much better programmer. Before we get to that stage, however, you need to build some basic fluency in R. Today we begin with the fundamental building blocks of R and RStudio: the interface, reading in data, and basic commands.
    </p>
    <p>
      Go ahead and launch RStudio. You should see a window that looks like the image shown below.
    </p>
    <p>
       <img style="width: 100%" src="img/r-interface-2019.png">
    </p>
    <p>
      The panel on the left is where the action happens. It's called the console. Everytime you launch RStudio, it will have the same text at the top of the console telling you the version of R that you're running. Below that information is the prompt. As its name suggests, this prompt is really a request: a request for a command. Initially, interacting with R is all about typing commands and interpreting the output. These commands and their syntax have evolved over decades (literally) and now provide what many users feel is a fairly natural way to access data and organize, describe, and invoke statistical computations.
    </p>
    <p>
      The panel in the upper right contains your workspace as well as a history of the commands that you've previously entered.
    </p>
    <p>
      Any plots that you generate will show up in the panel in the lower right corner. This is also where you can browse your files, access help, manage packages, etc.
    </p>

    <h4 class="w3-text-grey">R Packages</h4>

    <p>
      R is an open-source programming language, meaning that users can contribute packages that make our lives easier, and we can use them for free. What is a package? Think of it as a neat collection of tools (that someone else built) that help us do common, repetitive tasks more efficiently. For this lab, and many others in the future, we will use the following R packages:
    </p>
    <ul>
      <li>
        <code>dplyr</code>: for data wrangling
      </li>
      <li>
        <code>ggplot2</code>: for data visualization (more on this in a few weeks)
      </li>
      <li>
        <code>tidyverse</code>: an umbrella package that encompasses the previous two and many more
      </li>
    </ul>
    <p>
      If these packages are not already available in your R environment, install them by typing the following line of code into the console of your RStudio session and pressing the enter/return key. Note that you can check to see which packages (and which versions) are installed by inspecting the <em>Packages</em> tab in the lower right panel of RStudio.
    </p>
    <pre class="r"><code>install.packages("tidyverse")</code></pre>
    <p>
      You may need to select a server from which to download; any of them will work.
    </p>
    <p>
      Next, you need to load these packages in your working environment. We do this with the <code>library</code> function. Run the following line in your console.
    </p>
    <pre class="r"><code>library(tidyverse)</code></pre>
    <p>
      Note that you only need to <em>install</em> packages once, but you need to <em>load</em> them each time you relaunch RStudio.
    </p>

     <h4 class="w3-text-grey">Creating a reproducible lab report</h4>
    
    <p>
      We will be using R Markdown to create reproducible lab reports. Remember, key pieces of ethical data science are (1) transparancy in your analyses, and (2) reproducibility. See the following videos describing more about why and how we use R Markdown:
    </p>
    <p>
      <a href="https://youtu.be/lNWVQ2oxNho"><strong>Why use R Markdown for Lab Reports?</strong></a>
    </p>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/lNWVQ2oxNho" frameborder="0" allowfullscreen>
    </iframe>
    <p>
      <a href="https://youtu.be/o0h-eVABe9M"><strong>Using R Markdown for Lab Reports in RStudio</strong></a>
    </p> 
    <iframe width="560" height="315" src="https://www.youtube.com/embed/o0h-eVABe9M" frameborder="0" allowfullscreen>
    </iframe>
    <p>
      Going forward you should refrain from typing your code directly in the console, and instead type any code (final correct answer, or anything you're just trying out) in the R Markdown file and run the chunk using either the Run button on the chunk (green sideways triangle) or by highlighting the code and clicking <code>Run</code> on the top right corner of the R Markdown editor. If at any point you need to start over, you can <code>Run All Chunks</code> above the chunk you're working in by clicking on the down arrow in the code chunk.
    </p>

  </div>
</div>

<div class="w3-row w3-padding-0">
  <div class="w3-twothird w3-container w3-margin-top">

    <h3 class="w3-text-grey">Loading Data</h3>

    <p>
      In order to do much of anything interesting in R, we'll first need some data. Many R packages contain datasets that are available once the package is loaded. Sometimes, delivering these datasets is the main purpose of the package. Other times, these datasets are used in the examples that illustrate the functions that the package provides.
    </p>
    <p>
      To see what data frames are available to your R session, use the <code>data()</code> command. This will cause a list of data objects organized by package to pop up in your RStudio window.
    </p>
    <blockquote>
      <p>
        Note: you should <strong>NOT</strong> include this command in an R Markdown document, since that window won't pop up!
      </p>
    </blockquote>
    <pre class="r"><code>data()</code></pre>
    <p>
      If you want to see only those data objects provided by a specific package, you can specify the <code>package</code> argument. For example, we might want to list all of the data objects provided by the <code>dplyr</code> package:
    </p>
    <pre class="r"><code>data(package = &quot;dplyr&quot;)</code></pre>
    <blockquote>
      <p>
        Note that not all data objects listed by <code>data()</code> are <code>data.frame</code>s! Some of them are <code>list</code>s and some have class <code>matrix</code>. (Don't worry about the difference between <code>data.frame</code>, <code>list</code>, and <code>matrix</code> for now, we'll dive into that later!)
      </p>
    </blockquote>

    <h4 class="w3-text-grey">Lazy Loading</h4>
    <p>
      Typically, data objects provided by R packages are loaded lazily. This means that you don't have to explicitly load the data with the <code>data()</code> function. Once the package is loaded, the data is made available to you. However, not <strong>all</strong> packages do this.
    </p>
  </div>
</div>

<div class="w3-row w3-padding-0">
  <div class="w3-twothird w3-container w3-margin-top">

    <h3 class="w3-text-grey">Data from a CSV</h3>

    <p>
      Most frequently, you'll probably want to load your own data into R. The simplest and most common way to get data into R is to import it from a CSV file. CSV stands for <a href="https://en.wikipedia.org/wiki/Comma-separated_values"><strong>C</strong>omma <strong>S</strong>eparated <strong>V</strong>alues</a>, and it is a non-proprietary file format for sharing tabular data (data organized into rows of variables and columns of observations).
    </p>
    <p>
      In your exploration of R, you may come across two differed &quot;spellings&quot; of commands that look very similar: <code>read.csv()</code> and <code>read_csv()</code>.
    </p>
    <ul>
      <li>
        The <code>read.csv()</code> command comes from <code>base</code> R; you don't need to load any packages to use it.
      </li>
      <li>
        However, this command has largely has been superseded by the <code>read_csv()</code> command from the <code>readr</code> package. <code>readr</code> is part of the <code>tidyverse</code> (which we loaded previously), and <code>read_csv()</code> is much faster than <code>read.csv()</code>. Additionally, this version will not automatically convert your character vectors to factors.
      </li>
    </ul>
    <p>
      TL;DR: I can't think of any reason to use <code>read.csv()</code> when you have the option to use <code>read_csv()</code>. Using this function, you can read a CSV file from your computer, or straight from the Internet via a <a href="https://en.wikipedia.org/wiki/URL">URL</a>. CSVs should have the file extension <code>.csv</code>. To get you started, run the following command to load the data from a comma-separated value (CSV) file hosted online:
    </p>
    <pre class="r"><code>magazines &lt;- read_csv(&quot;http://gattonweb.uky.edu/sheather/book/docs/datasets/magazines.csv&quot;)</code></pre>
    <p>
      You can do this by
    </p>
    <ul>
      <li>
        clicking on the green arrow at the top right of the code chunk in the R Markdown (Rmd) file, or
      </li>
      <li>
        putting your cursor on this line, and hit the <strong>Run</strong> button on the upper right corner of the pane, or
      </li>
      <li>
        hitting <code>Ctrl-Shift-Enter</code>, or
      </li>
      <li>
        typing the code in the console and hitting <code>Enter</code>.
      </li>
    </ul>
    <p>
      This command instructs R to load some data (specifically, revenue and advertising data from <em>Advertising Age</em>'s 14th annual Magazine 300 Report, which was released in September 2003) and to save that data as an objet with the name  `magazines`. You should see that the workspace area in the upper righthand corner of the RStudio window now lists a dataset called <code>magazines</code> that has 204 observations (obs.) on 5 variables. The <code><-</code> symbol you used in this command is the assignment operator in R. We read this symbol as &lq;gets&rq;, for example if you were reading out loud the command we just ran you would say something like: &lq;<code>magazines</code> gets <em>Advertising Age</em> data&rq;.
    </p>
    <p>
      As you interact with R, you will create a series of objects. Sometimes you'll load them from a file as we have done here, and sometimes you'll create them yourself as the byproduct of a computation or some analysis you have performed.
    </p>
    <p>
      We can view the contents of an object by typing its name into the console.
    </p>
    <pre class="r"><code>magazines</code></pre>
    <p>
      However printing the whole dataset in the console is not that useful. One advantage of RStudio is that it comes with a built-in data viewer. Click on the name <code>magazines</code> in the <em>Environment</em> pane (upper right window) that lists the objects in your workspace. This will bring up an alternative display of the dataset in the <em>Data Viewer</em> (upper left window), which looks something like this:
    </p>
    <p>
      <img style="width: 100%" src="img/magazines.png" /> <br>
    </p>
    <p>
      The colums of the dataset are as follows:
    </p>
    <ul>
      <li>
        <code>Magazine</code>: the name of the magazine
      </li>
      <li>
        <code>AdRevenue</code>: revenue from advertising (in thousands of $)
      </li>
      <li>
        <code>AdPages</code>: number of pages of paid advertising
      </li>
      <li>
        <code>SubRevenue</code>: revenue from paid subscriptions (in thousands of $)
      </li>
      <li>
        <code>NewsRevenue</code>: revenue from newsstand sales (in thousands of $)
      </li>
    </ul>
    <p>
      Use the scrollbar on the right side of the console window to examine the complete dataset.
    </p>
    <p>
      Note that the row numbers in the first column are not part of the dataset; R adds them as part of its printout to help you make visual comparisons. You can think of them as the index that you see on the left side of a spreadsheet. In fact, the comparison to a spreadsheet will generally be helpful. R has stored <em>Advertising Age</em>'s data in a kind of spreadsheet or table called a <em>data frame</em>.
    </p>
    <p>
      You can see the dimensions of this data frame as well as the names of the variables and the first few observations by typing:
    </p>
    <pre class="r"><code>glimpse(magazines)</code></pre>
    <p>
      At this point, you might notice that many of the commands in R look a lot like functions from math class; that is, invoking R commands means supplying a function with some number of arguments. The <code>glimpse</code> command, for example, took a single argument, the name of a data frame.
    </p>
  </div>
</div>

<div class="w3-row w3-padding-0">
  <div class="w3-twothird w3-container w3-margin-top">

    <h3 class="w3-text-grey">Some Exploration</h3>

    <p>
      Let's start to examine the data a little more closely. We can access the data in a single column of a data frame separately using a command like
    </p>
    <pre class="r"><code>pull(magazines, AdRevenue)</code></pre>
    <p>
      This command will only show the <code>AdRevenue</code> for each magazine. In a sense, <code>pull()</code> extracts the variable <code>AdRevenue</code> from the data frame <code>magazines</code>.
    </p>
    <blockquote>
      <p>
        What command would you use to extract just the subscription revenue? <br/><br/> Try it!
      </p>
    </blockquote>
    <p>
      Notice that the way R has printed these data is different. When we looked at the complete data frame, we saw 204 rows, one on each line of the display. These data are no longer structured in a table with other variables, so they are displayed one right after another. Objects that print out in this way are called <em>vectors</em>; they represent a set of numbers. R has added numbers in [brackets] along the left side of the printout to indicate locations within the vector. For example, 5218 follows [1], indicating that 854 is the first entry in the vector. And if [45] starts a line, then that would mean the first number on that line would represent the 45th entry in the vector.
    </p>
    
    <h4 class="w3-text-grey">Data Visualization</h4>
    
    <p>
      R has some powerful functions for making graphics. We can create a simple plot of the amount of Ad Revenue per Ad Pages with the command
    </p>
    <pre class="r"><code>qplot(x = AdPages, y = AdRevenue, data = magazines)</code></pre>
    <p>
      The <code>qplot()</code> function (meaning &quot;quick plot&quot;) considers the type of data you have provided it and makes the decision to visualize it with a scatterplot. The plot should appear under the <em>Plots</em> tab of the lower right panel of RStudio.
    </p>
    <p>
      Notice that the command above again looks like a function, this time with three arguments separated by commas. The first two arguments in the <code>qplot()</code> function specify the variables for the x-axis and the y-axis and the third provides the name of the dataset where they can be found. If we wanted to connect the data points with lines, we could add a fourth argument to specify the geometry that we'd like.
    </p>
    <pre class="r"><code>qplot(x = AdPages, y = AdRevenue, data = magazines, geom = &quot;line&quot;)</code></pre>
    <p>
      You might wonder how you are supposed to know that it was possible to add that fourth argument. Thankfully, R documents all of its functions extensively. To read what a function does and learn the arguments that are available to you, just type in a question mark followed by the name of the function that you're interested in. Try the following.
    </p>
    <pre class="r"><code>?qplot</code></pre>
    <p>
      Notice that the help file replaces the plot in the lower right panel. You can toggle between plots and help files using the tabs at the top of that panel.
    </p>
    <blockquote>
      <p>
        Is there an apparent trend in the amount of advertising revenue relative to the number of ad pages? <br/><br/> How would you describe it? <br/><br/> (To ensure that your lab report is comprehensive, be sure to include the code needed to make the plot as well as your written interpretation.)
      </p>
    </blockquote>
    
    <h4 class="w3-text-grey">R as a big calculator</h4>
    <p>
      Now, suppose we want to plot the total revenue for advertising, subscriptions, and newsstand sales combined. To compute this, we could use the fact that R is really just a big calculator. We can type in mathematical expressions like
    </p>
    <pre class="r"><code>2280 + 854 + 16568</code></pre>
    <p>
      to see the total revenue for the <em>Weekly World News</em>. We could repeat this once for each magazine, but there is a faster way. If we add the vectors for <code>AdRevenue</code>, <code>SubRevenue</code>, and <code>NewsRevenue</code>, R will compute all sums simultaneously.
    </p>
    <pre class="r"><code>pull(magazines, AdRevenue) + pull(magazines, SubRevenue) + pull(magazines, NewsRevenue)</code></pre>
    <p>
      What you will see are 204 numbers (in that packed display, because we aren’t looking at a data frame here), each one representing the sum we’re after. Take a look at a few of them and verify that they are right.
    </p>
    
    <h4 class="w3-text-grey">Adding a new variable to the data frame</h4>
    <p>
      We'll be using this new vector to generate some plots, so we'll want to save it as a permanent column in our data frame.
    </p>
    <pre class="r"><code>magazines &lt;- magazines %&gt;%
      mutate(TotalRevenue = AdRevenue + SubRevenue + NewsRevenue)</code></pre>
    <p>
      The <code>%&gt;%</code> operator is called the <strong>pipe</strong> operator. It takes the output of the previous expression and sends (or &quot;pipes&quot;) it in as the first argument to the next function in the chain.
    </p>
    <p>
      To continue our analogy with mathematical functions, <code>x %&gt;% f(y)</code> is just another way of writing to <code>f(x, y)</code>.
    </p>
    <p>
      <strong>A note on piping: </strong> we can read these three lines of code as the following:
    </p>
    <ol>
      <li>
        <em>Take the <code>magazines</code> dataset and <strong>pipe</strong> it into the <code>mutate</code> function.</em>
      </li>
      <li>
        <em>Mutate the <code>magazines</code> dataset by creating a new variable called <code>TotalRevenue</code> that is the sum of the variables called <code>AdRevenue</code>, <code>SubRevenue</code>, and <code>NewsRevenue</code>. </em>
      </li>
      <li>
        <em>Finally, assign the resulting dataset to the object called <code>magazines</code>, i.e. overwrite the old <code>magazines</code> dataset with the new one containing the new variable.</em>
      </li>
    </ol>
    <p>
      This is equivalent to going through each row and adding up the <code>AdRevenue</code>, <code>SubRevenue</code>, and <code>NewsRevenue</code> values for that magazine and recording that value in a new column called <code>total</code>. We'll learn a bunch more about piping later.
    </p>
    <p>
      <strong>Where is the new variable? </strong> When you make changes to variables in your dataset, click on the name of the dataset again to update it in the data viewer.
    </p>
    <p>
      You'll see that there is now a new column called <code>TotalRevenue</code> that has been tacked on to the data frame. Remember, the special symbol <code>&lt;-</code> performs an <em>assignment</em>, taking the output of one line of code and saving it into an object in your workspace. In this case, you already have an object called <code>magazines</code>, so this command updates that dataset with the new mutated column.
    </p>
    <p>
      We can make a histogram showing how the total revenues are distributed with the command:
    </p>
    <pre class="r"><code>qplot(x = TotalRevenue, data = magazines, geom = &quot;histogram&quot;)</code></pre>
    <p>
      Similarly to how we computed the total revenue, we can compute the average revenue per page for each magazine:
    </p>
    <pre class="r"><code>magazines &lt;- magazines %&gt;%
      mutate(PerPageRevenue = AdRevenue / AdPages)</code></pre>
    <p>
      <strong>Tip: </strong> If you use the up and down arrow keys, you can scroll through your previous commands, your so-called command history. You can also access it by clicking on the history tab in the upper right panel. This will save you a lot of typing in the future.
    </p>
    <p>
      Finally, in addition to simple mathematical operators like subtraction and division, you can ask R to make comparisons like greater than, <code>&gt;</code>, less than, <code>&lt;</code>, and equality, <code>==</code>. For example, we can ask if a magazine does better at newsstand (one-off)or subscription sales with the expression:
    </p>
    <pre class="r"><code>magazines &lt;- magazines %&gt;%
      mutate(OneOff = NewsRevenue &gt; SubRevenue)</code></pre>
    <p>
      This command adds a new variable to the <code>magazines</code> dataframe containing the values of either <code>TRUE</code> if that magazine had higher newsstand revenue than subscription revenue, or <code>FALSE</code> otherwise (the answer may surprise you). For example, check out what happens if we sort the dataframe by descending <code>TotalRevenue</code>:
    </p>
    <p>
      <img style="width: 100%" src="img/magazines-oneoff.png" /> <br>
    </p>
    <p>
      This variable contains a different kind of data than we have encountered so far. All other columns in the <code>magazines</code> data frame have values that are numerical. Here, we've asked R to create <em>logical</em> data, data where the values are either <code>TRUE</code> or <code>FALSE</code>. In general, data analysis will involve many different kinds of data types, and one reason for using R is that it is able to represent and compute with many of them.
      </p>
  </div>
</div>

<div class="w3-row w3-padding-0">
  <div class="w3-twothird w3-container w3-margin-top">

    <h3 class="w3-text-grey">More Practice</h3>

    <p>
      In the previous few sections, you recreated some of the displays and preliminary analysis of magazine revenue data. Your task for the rest of this session involves repeating these steps, but for <strong>a dataset of your own choosing</strong>. Find or load a new dataset, and try answering the following questions:
    </p>
    <ol style="list-style-type: decimal">
      <li>
        What columns are included in the dataset?
      </li>
      <li>
        How many records does it contain?
      </li>
      <li>
        What patterns/relationships do you notice?
      </li>
    </ol>
  </div>
</div>

<div class="w3-row w3-padding-0">
  <div class="w3-twothird w3-container w3-margin-top">
    <p>
      This is a product of OpenIntro that is released under a <a href="http://creativecommons.org/licenses/by-sa/3.0">Creative Commons Attribution-ShareAlike 3.0 Unported</a>. This lab was adapted for <a href="https://www.openintro.org/">OpenIntro by Andrew Bray and Mine Çetinkaya-Rundel</a> from a lab written by <a href="http://www.stat.ucla.edu/~cocteau/">Mark Hansen of UCLA Statistics</a>, was modified for MassMutual DSDP by <a href="jcrouser.github.io">R. Jordan Crouser</a> in June 2021, and was modified for the Smith College SSEP by Ab Mosca in June 2022.
    </p>
  </div>
</div>



